<div class="container my-5">
  <div class="row">
    <div class="col-md-8">
      <!-- Project Information -->
      <div class="card mb-4 shadow-sm">
        <div class="card-body">
          <h1 class="card-title text-primary">Project: <%= @project.name %></h1>
          <p class="card-text">
            <strong>Current Status:</strong> 
            <span class="badge <%= @project.status == 'completed' ? 'bg-success' : 'bg-info' %>">
              <%= @project.status.humanize %>
            </span>
          </p>
        </div>
      </div>

      <!-- Project History -->
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light">
          <h2 class="card-title text-secondary">Project History</h2>
        </div>
        <ul class="list-group list-group-flush">
          <% @history.each do |item| %>
            <li class="list-group-item">
              <strong><%= item.user.email %>:</strong> 
              <% if item.item_type == 'Comment' %>
                commented: "<%= item.item.content %>" 
              <% elsif item.item_type == 'Project' %>
                <%= item.description %>
              <% end %>
              <span class="text-muted float-end"><%= l(item.created_at, format: :short) %></span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>

    <!-- Sidebar content -->
    <div class="col-md-4">
      <!-- Add Comment -->
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light">
          <h3 class="card-title text-secondary">Add Comment</h3>
        </div>
        <div class="card-body">
          <%= form_with model: [@project, Comment.new], local: true do |form| %>
            <div class="mb-3">
              <%= form.label :content, "Comment", class: "form-label" %>
              <%= form.text_area :content, rows: 3, class: "form-control", placeholder: "Write your comment here..." %>
            </div>
            <div class="d-grid">
              <%= form.submit "Add Comment", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Change Project Status (Admins only) -->
      <% if current_user.admin? %>
        <div class="card mb-4 shadow-sm">
          <div class="card-header bg-light">
            <h3 class="card-title text-secondary">Change Status</h3>
          </div>
          <div class="card-body">
            <%= form_with url: project_statuses_path(@project), method: :put, local: true do |form| %>
              <div class="mb-3">
                <%= form.label :status, "New Status", class: "form-label" %>
                <%= form.select :status, Project.statuses.keys.map { |status| [status.humanize, status] }, { selected: @project.status }, class: "form-select" %>
              </div>
              <div class="d-grid">
                <%= form.submit "Change Status", class: "btn btn-warning" %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>